<!DOCTYPE html>
<html>
  
  <head>
    <title>REGALS experiment</title>
    
    <!-- JsPsych and Plugins -->
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>

    

    <script src="consent.js"></script>
    <script src="instructions.js"></script>
    <!--<script src="demographics.js"></script>-->
    <script src="LLMCases.js"></script>
    <script src="lawyerCases.js"></script>

    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="style.css">

  </head>
  
  <body></body>
  
  <script>
    const jsPsych = initJsPsych();

    var timeline = [];

    timeline.push(consent,instructions)

    // Function to shuffle and slice cases
    const prepareCases = (cases) => jsPsych.randomization.shuffle(cases).slice(0, 3);

    //Create one for each domain with cases in randomised order, same for lawyer
    var traffic_cases_LLM = prepareCases(traffic_cases_LLM);
    var plan_cases_LLM = prepareCases(plan_cases_LLM);
    var prop_cases_LLM = prepareCases(prop_cases_LLM);

    var traffic_cases_Lawyer = prepareCases(traffic_cases_Lawyer);
    var plan_cases_Lawyer = prepareCases(plan_cases_Lawyer);
    var prop_cases_Lawyer = prepareCases(prop_cases_Lawyer);

    //As we only need three of the six cases pr. participant, we simply
    //take the first three elements of the randomised array and add them
    //to the participants array for the LLM and Lawyer respectively
    var  participant_LLM = [...traffic_cases_LLM, ...plan_cases_LLM, ...prop_cases_LLM];
    var participant_Lawyer = [...traffic_cases_Lawyer, ...plan_cases_Lawyer, ...prop_cases_Lawyer];

    // concat the two to create one balanced (by source and domain) array pr participant
    var all_cases = jsPsych.randomization.shuffle([...participant_LLM, ...participant_Lawyer]);

    // Give each participant a random number
    var rnd_id = Math.floor(Math.random() * 100);

    // Set nonBlind to true IF the number is even, set blindedText if nonBlind is true
    var nonBlind = rnd_id % 2 === 0;
    var blindedText = nonBlind ? ": This advice has been written by a " : "";

    // Function to get the source
    const getSource = (caseText) => caseText.includes("L1") ? "lawyer." : "Large Language Model (LLM).";

    // Iterate through all all_cases
    for (let i = 0; i < all_cases.length; i++) {
      // Extract the current caseText and check using getSource if it contains L1
      var caseText = all_cases[i];
      var source = nonBlind ? getSource(caseText) : "";

      // If nonBlind is false, both blindedText and source will be empty 
      var prompt = `
        <h3 class="Case">Case ${i + 1} ${blindedText} ${source}</h3> 
        ${caseText}<br><span style="background: lightblue">Required field 
        deactivated for the sake of testing.</span>
      `;

      timeline.push({
        timeline: [{
          type: jsPsychSurveyLikert,
          questions: [{
            prompt: prompt,
            labels: [
              "1: Strongly Disagree",
              "2",
              "3",
              "4",
              "5: Neutral",
              "6",
              "7",
              "8",
              "9: Strongly Agree"
            ],
            //required: true
          }]
        }]
      });
    }

  timeline.push(debrief);
  jsPsych.run(timeline);
    
    // // iterate through the num_cases 
    // for (let i = 0; i < all_cases.length; i++) {
    //   // if the participant is in the non-blinded condition, display if the 
    //   // case was lawyer or LLM generated
    //   if (nonBlind) {
    //     source = all_cases[i].includes("L1") ? "lawyer." : "Large Language Model (LLM).";
    //   }

    // // Concatenate strings to form the prompt
    // let prompt = '<h3 class="Case">Case ' + (i + 1) + ' ' + blindedText + 
    //               source + '</h3> ' + all_cases[i] + '<br>' + 
    //               '<span style="background: lightblue">Required field deactivated for the sake of testing.</span>';


    //   timeline.push({
    //     timeline: [{
    //       type: jsPsychSurveyLikert,
    //       questions: [{
    //         prompt: prompt,
    //         labels: [
    //           "1: Strongly Disagree",
    //           "2",
    //           "3",
    //           "4",
    //           "5: Neutral",
    //           "6",
    //           "7",
    //           "8",
    //           "9: Strongly Agree"
    //         ],
    //         //required: true
    //       }]
    //     }]
    //   });
    // }

    // timeline.push(debrief)

    // jsPsych.run(timeline);

  </script>

</html>
