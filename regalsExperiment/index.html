<!DOCTYPE html>
<html>
  
  <head>
    <title>REGALS experiment</title>
    
    <!-- JsPsych and Plugins -->
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>

    

    <script src="consent.js"></script>
    <script src="instructions.js"></script>
    <!--<script src="demographics.js"></script>-->
    <script src="LLMCases.js"></script>
    <script src="lawyerCases.js"></script>

    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="style.css">

  </head>
  
  <body></body>
  
  <script>
    const jsPsych = initJsPsych();

    var timeline = [];

    // Turn fullscreen on
    timeline.push({
      type: jsPsychFullscreen,
      fullscreen_mode: true,
      data: {
        Condition: 'REMOVE', // For easier data processing
        Running: 'Fullscreen on'
      }
    });

    timeline.push(consent,instructions)

    // Function to shuffle randomise cases and take the first three (slice)
    const prepareCases = (cases) => jsPsych.randomization.shuffle(cases).slice(0, 3);

    // Concatenate the six arrays to create one array
    var all_cases = [traffic_cases_LLM, plan_cases_LLM, prop_cases_LLM, 
      traffic_cases_Lawyer, plan_cases_Lawyer, prop_cases_Lawyer];

    // Iterate over each element and shuffle and slice (3) each using prepareCases
    // assign to a new variable 
    for (let i = 0; i < all_cases.length; i++) {
      all_cases[i] = prepareCases(all_cases[i]);
    }

    // Concatenate the six arrays to create one balanced (by source and domain) array pr participant
    all_cases = jsPsych.randomization.shuffle([].concat(...all_cases));

    // Give each participant a random number
    var rnd_id = Math.floor(Math.random() * 100);

    // Set isNonBlind to true IF the number is even
    const isNonBlind = rnd_id % 2 === 0;

    // Function to get the source
    const getSource = (caseText) => caseText.includes("L1") ? "lawyer." : "Large Language Model (LLM).";

    const num_cases = 18

    // Iterate through all all_cases
    for (let i = 0; i < num_cases; i++) {
      // Extract the current caseText and check using getSource if it contains L1
      var caseText = all_cases[i];
      // Define the Source text based on isNonBlind
      var source = isNonBlind ? getSource(caseText) : "";

      // Ternary operator to insert source text IF isNonBlind is true, else empty 
      var prompt = `
        <h3 class="Case">Case ${i + 1}${isNonBlind ? ": This advice has been written by a " + source : ""}</h3> 
        ${caseText}<br><span style="background: lightblue">Required field 
        deactivated for the sake of testing.</span>`;

      timeline.push({
        timeline: [{
          type: jsPsychSurveyLikert,
          questions: [{
            prompt: prompt,
            labels: [
              "1: Strongly Disagree",
              "2",
              "3",
              "4",
              "5: Neutral",
              "6",
              "7",
              "8",
              "9: Strongly Agree"
            ],
            //required: true
          }]
        }]
      });
    }

  timeline.push(debrief);
  jsPsych.run(timeline);
  </script>

</html>
